<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>íšŒì› ëª©ë¡</title>
<script type="text/javascript">
function fetchMembers(){
	fetch('/api/members',{method:'GET'})
	.then(response => {
		if(!response.ok){
			throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì˜¤ë¥˜~');
		}
		return response.json();
	})
	.then(members => {
		displayMembers(members);
	})
	.catch(error => {  
		console.log('ì½ê¸° ì¤‘ ì—ëŸ¬ : ', error);
	})
}

function displayMembers(members){
	const tableBody = document.getElementById('tableBody');
	tableBody.innerHTML = '';  // ì´ˆê¸°í™”
	
	members.forEach(member => {
		const row = document.createElement('tr'); // DOM ì‚¬ìš©
		row.innerHTML = `
			<td>${member.num}</td>
			<td>${member.name}</td>
			<td>${member.addr}</td>
			<td><a href="#" onclick="editMember(${member.num})">ìˆ˜ì •</a></td>
			<td><a href="#" onclick="deleteMember(${member.num})">ì‚­ì œ</a></td>
		`;
		tableBody.appendChild(row);
	});
}

function editMember(num){
	location.href = `/members/update/${num}`; // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
}

function deleteMember(num){
	if(confirm("ì •ë§ ì‚­ì œí•œë””????ì‘? ì‚­ì œí•œë””?!")){
		fetch(`/api/members/${num}`,{method:'DELETE'})
		.then(response => {
			if(!response.ok){
				throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì˜¤ë¥˜~');
			}
			 fetchMembers(); // ì‚­ì œ í›„ ëª©ë¡ ë³´ê¸°
		})
		.then(members => {
			displayMembers(members);
		})
		.catch(error => {  
			console.log('ì½ê¸° ì¤‘ ì—ëŸ¬ : ', error);
		})
	}
}
</script>
</head>
<body>
<h3>ğŸ‰ íšŒì› ì •ë³´ ğŸ‰</h3>
<a th:href="@{/}">â­ë©”ì¸ìœ¼ë¡œâ­</a>
<br>
<a th:href="@{/members/new}">ğŸ¤—íšŒì› ì¶”ê°€ğŸ¤—</a>
<br><br>
<button onclick="fetchMembers()">íšŒì› ì½ê¸°</button>
<br><br>
<table border="1">
	<thead>
		<tr>
			<th>ë²ˆí˜¸âœ…</th><th>ì´ë¦„ğŸ“</th><th>ì£¼ì†ŒğŸ </th><th>ìˆ˜ì •âœï¸</th><th>ì‚­ì œâŒ</th>
		</tr>
	</thead>
	<tbody id="tableBody">
	  <!-- íšŒì›ìë£Œ í‘œì‹œ ìœ„ì¹˜ -->
	</tbody>
</table>
</body>
</html>
